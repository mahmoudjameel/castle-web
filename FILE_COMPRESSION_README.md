# ضغط الملفات - File Compression

## نظرة عامة
تم إضافة نظام ضغط الملفات لحل مشكلة رفع الصور والفيديوهات من الهواتف المحمولة. النظام يقوم بضغط الملفات تلقائياً قبل الرفع لتقليل حجمها وتحسين الأداء.

## الميزات الجديدة

### 1. ضغط الصور
- **الحد الأقصى للعرض**: 1920 بكسل
- **جودة الضغط**: 80% (قابلة للتعديل)
- **الدعم**: جميع أنواع الصور (JPEG, PNG, WebP, إلخ)
- **التقليل المتوقع**: 60-80% من الحجم الأصلي

### 2. ضغط الفيديوهات
- **الحد الأقصى للعرض**: 1280 بكسل
- **معدل البتات**: 1 Mbps
- **التنسيق**: WebM (VP9)
- **معدل الإطارات**: 30 FPS
- **التقليل المتوقع**: 70-90% من الحجم الأصلي

### 3. مؤشر التقدم
- شريط تقدم مرئي أثناء الضغط
- رسائل حالة واضحة
- معلومات حجم الملف قبل وبعد الضغط

## الملفات المحدثة

### 1. `src/lib/fileCompression.ts`
مكتبة ضغط الملفات الرئيسية تحتوي على:
- `compressImage()` - ضغط الصور
- `compressVideo()` - ضغط الفيديوهات
- `compressFile()` - ضغط ملف واحد حسب النوع
- `compressFiles()` - ضغط عدة ملفات
- `getFileSizeMB()` - حساب حجم الملف
- `isFileSizeAcceptable()` - التحقق من حجم الملف

### 2. `src/app/talent/portfolio/page.tsx`
تحديث صفحة Portfolio لتشمل:
- استيراد مكتبة الضغط
- ضغط الصور قبل الرفع
- ضغط الفيديوهات قبل الرفع
- مؤشر تقدم الضغط
- معالجة الأخطاء المحسنة

### 3. `src/app/api/portfolio/route.ts`
تحديث API route لتشمل:
- إعدادات bodyParser لزيادة حجم الملفات المسموح إلى 50MB
- دعم أفضل للملفات الكبيرة

### 4. `next.config.ts`
تحديث إعدادات Next.js:
- إضافة مكتبة sharp للضغط على الخادم
- تحسين إعدادات الملفات

## كيفية الاستخدام

### للمطورين
```typescript
import { compressFile, compressFiles } from '@/lib/fileCompression';

// ضغط ملف واحد
const compressedFile = await compressFile(originalFile);

// ضغط عدة ملفات
const compressedFiles = await compressFiles(originalFiles);
```

### للمستخدمين
1. اختر الصور أو الفيديوهات المراد رفعها
2. سيتم ضغطها تلقائياً قبل الرفع
3. ستظهر رسالة "جاري الضغط..." مع شريط التقدم
4. بعد الانتهاء، سيتم رفع الملفات المضغوطة

## الإعدادات القابلة للتعديل

### ضغط الصور
```typescript
// في fileCompression.ts
export async function compressImage(
  file: File, 
  maxWidth: number = 1920,  // الحد الأقصى للعرض
  quality: number = 0.8     // الجودة (0.1 - 1.0)
)
```

### ضغط الفيديوهات
```typescript
// في fileCompression.ts
export async function compressVideo(
  file: File, 
  maxSizeMB: number = 10    // الحد الأقصى للحجم بالميجابايت
)
```

## الفوائد

### 1. تحسين الأداء
- تقليل وقت الرفع
- تقليل استهلاك البيانات
- تحسين تجربة المستخدم

### 2. توفير المساحة
- تقليل مساحة التخزين
- تحسين سرعة التحميل
- تقليل تكاليف الاستضافة

### 3. دعم أفضل للهواتف
- حل مشكلة رفع الملفات الكبيرة
- دعم أفضل للشبكات البطيئة
- تجربة موحدة عبر الأجهزة

## استكشاف الأخطاء

### مشاكل شائعة
1. **فشل الضغط**: تحقق من نوع الملف المدعوم
2. **حجم كبير بعد الضغط**: قلل من الجودة أو الحد الأقصى للعرض
3. **بطء في الضغط**: قلل من دقة الفيديو أو معدل البتات

### رسائل الخطأ
- "فشل في ضغط الصورة" - خطأ في معالجة الصورة
- "فشل في ضغط الفيديو" - خطأ في معالجة الفيديو
- "حدث خطأ في ضغط الملفات" - خطأ عام في الضغط

## التطوير المستقبلي

### ميزات مقترحة
1. **ضغط متقدم**: خوارزميات ضغط أكثر تطوراً
2. **ضغط متوازي**: ضغط عدة ملفات في نفس الوقت
3. **ضغط ذكي**: اختيار إعدادات الضغط حسب نوع الملف
4. **ضغط تدريجي**: ضغط تدريجي للفيديوهات الطويلة

### تحسينات الأداء
1. **Web Workers**: ضغط في خيط منفصل
2. **Streaming**: ضغط أثناء الرفع
3. **Caching**: تخزين مؤقت للملفات المضغوطة

## الدعم الفني

إذا واجهت أي مشاكل مع نظام الضغط:
1. تحقق من وحدة التحكم في المتصفح للأخطاء
2. تأكد من دعم المتصفح للميزات المستخدمة
3. جرب تقليل حجم الملف الأصلي
4. تواصل مع فريق التطوير

---

**ملاحظة**: هذا النظام يعمل في المتصفح فقط ولا يتطلب خادم إضافي للضغط.
